<Window
  x:Name="window"
  x:Class="MalwarePatch.Windows.Main.MainWindow"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:model="clr-namespace:MalwarePatch.Models"
  mc:Ignorable="d"
  Title="{Binding [TextAvailablePatches]}"
  ResizeMode="CanMinimize"
  Height="565"
  Width="672"
  Topmost="{Binding IsChecked, ElementName=buttonTop}"
  WindowStartupLocation="CenterScreen"
  Icon="../../MalwarePatch.ico"
  Background="{DynamicResource Background}"
  Foreground="{DynamicResource Foreground}">
  <Window.Resources>
    <ResourceDictionary>
      <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary
          Source="../../Styles/CertificateSwitch.xaml" />
        <ResourceDictionary
          Source="../../Styles/ToolButton.xaml" />
        <ResourceDictionary
          Source="../../Styles/LightScrollViewer.xaml" />
      </ResourceDictionary.MergedDictionaries>
      <model:UIElementToImageConverter
        x:Key="imageConverter"/>
    </ResourceDictionary>
  </Window.Resources>
  <WindowChrome.WindowChrome>
    <WindowChrome
      ResizeBorderThickness="0"
      CaptionHeight="0"
      GlassFrameThickness="1,0,0,0" />
  </WindowChrome.WindowChrome>
  <!--<Window.TaskbarItemInfo>
    <TaskbarItemInfo>
      <TaskbarItemInfo.ThumbButtonInfos>
        <ThumbButtonInfo
          Command="{Binding DisallowFileCommand}"
          Description="{Binding [DisallowProgram]}"
          ImageSource="{Binding Source={StaticResource DisallowFile}, Converter={StaticResource imageConverter}}" />
        <ThumbButtonInfo
          Command="{Binding AllowFileCommand}"
          Description="{Binding [AllowProgram]}"
          ImageSource="{Binding Source={StaticResource AllowFile}, Converter={StaticResource imageConverter}}" />
      </TaskbarItemInfo.ThumbButtonInfos>
    </TaskbarItemInfo>
  </Window.TaskbarItemInfo>-->
  
  <Border
    x:Name="borderMain"
    BorderThickness="1"
    BorderBrush="{DynamicResource DwmColor}">
    <Grid
      x:Name="gridMain">
      <Grid.RowDefinitions>
        <RowDefinition
          Height="110" />
        <RowDefinition />
        <RowDefinition
          Height="40" />
        <RowDefinition
          Height="40" />
      </Grid.RowDefinitions>
      <Border
        x:Name="borderContent"
        Margin="0"
        Grid.Row="1">
        <ScrollViewer
          Style="{StaticResource LightScrollViewer}"
          x:Name="scroll"
          HorizontalScrollBarVisibility="Hidden"
          VerticalScrollBarVisibility="Auto"
          Margin="30,15,30,0">
          <ItemsControl
            ItemsSource="{Binding Certificates}"
            IsEnabled="{Binding IsNotBusy}"
            x:Name="certificatesPanel"
            ItemTemplate="{StaticResource CertificateTemplate}"
            Width="{Binding ActualWidth, ElementName=scroll}"
            VerticalAlignment="Top">
            <ItemsControl.ItemsPanel>
              <ItemsPanelTemplate>
                <WrapPanel />
              </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
          </ItemsControl>
        </ScrollViewer>
      </Border>
      <Grid
        Grid.Row="2"
        x:Name="gridUserCertificates">
        <Grid.ColumnDefinitions>
          <ColumnDefinition />
          <ColumnDefinition />
        </Grid.ColumnDefinitions>
        <Button
          Background="Transparent"
          Command="{Binding DisallowFileCommand}"
          Style="{StaticResource ToolButton}">
          <StackPanel
            Orientation="Horizontal">
            <ContentControl
              Height="24"
              Width="24"
              VerticalAlignment="Center"
              Content="{StaticResource DisallowFile}" />
            <TextBlock
              VerticalAlignment="Center"
              Foreground="{DynamicResource Foreground}"
              Text="{Binding [DisallowProgram]}"
              Margin="12,0"/>
          </StackPanel>
        </Button>
        <Button
          Grid.Column="1"
          Command="{Binding AllowFileCommand}"
          Background="Transparent"
          Style="{StaticResource ToolButton}">
          <StackPanel
            Orientation="Horizontal">
            <ContentControl
              Height="24"
              Width="24"
              VerticalAlignment="Center"
              Content="{StaticResource AllowFile}" />
            <TextBlock
              VerticalAlignment="Center"
              Foreground="{DynamicResource Foreground}"
              Text="{Binding [AllowProgram]}"
              Margin="12,0" />
          </StackPanel>
        </Button>
      </Grid>
      <Border
        x:Name="borderHeader"
        VerticalAlignment="Stretch"
        HorizontalAlignment="Stretch"
        Margin="0"
        Background="{DynamicResource TitleBarBackground}">
        <TextBlock
          x:Name="textAvailablePatches"
          TextWrapping="NoWrap"
          Text="{Binding [TextAvailablePatches]}"
          FontSize="36"
          VerticalAlignment="Center"
          HorizontalAlignment="Center" />
      </Border>
      <StackPanel
        Grid.Row="3"
        Background="{DynamicResource ToolbarBackground}"
        Orientation="Horizontal">
        <Button
          IsEnabled="{Binding IsNotBusy}"
          x:Name="buttonUncheckAll"
          Command="{Binding ButtonUncheckAllCommand}"
          Width="168"
          Height="40"
          Foreground="{DynamicResource Foreground}"
          Style="{StaticResource ToolButton}">
          <StackPanel
            Orientation="Horizontal">
            <ContentControl
              VerticalAlignment="Center"
              Margin="0,0,12,0"
              Content="{StaticResource UncheckAll}" />
            <TextBlock
              Text="{Binding [ButtonUncheckAll]}"
              VerticalAlignment="Center"
              FontSize="13" />
          </StackPanel>
        </Button>
        <Button
          x:Name="buttonCheckAll"
          IsEnabled="{Binding IsNotBusy}"
          Command="{Binding ButtonCheckAllCommand}"
          Width="168"
          Height="40"
          Foreground="{DynamicResource Foreground}"
          Style="{StaticResource ToolButton}">
          <StackPanel
            Orientation="Horizontal">
            <ContentControl
              VerticalAlignment="Center"
              Margin="0,0,12,0"
              Content="{StaticResource CheckAll}" />
            <TextBlock
              Text="{Binding [ButtonCheckAll]}"
              VerticalAlignment="Center"
              FontSize="13" />
          </StackPanel>
        </Button>
        <Button
          x:Name="buttonSave"
          IsEnabled="{Binding IsNotBusy}"
          Foreground="{DynamicResource Foreground}"
          Command="{Binding ButtonSaveCommand}"
          Width="168"
          Height="40"
          Style="{StaticResource ToolButton}">
          <StackPanel
            Orientation="Horizontal">
            <ContentControl
              VerticalAlignment="Center"
              Margin="0,0,12,0"
              Content="{StaticResource Save}" />
            <TextBlock
              Text="{Binding [ButtonSave]}"
              VerticalAlignment="Center"
              FontSize="13" />
          </StackPanel>
        </Button>
        <Button
          x:Name="buttonUpdate"
          Command="{Binding ButtonUpdateCommand}"
          IsEnabled="{Binding IsNotBusy}"
          Foreground="{DynamicResource Foreground}"
          Width="168"
          Height="40"
          Style="{StaticResource ToolButton}">
          <StackPanel
            Orientation="Horizontal">
            <ContentControl
              VerticalAlignment="Center"
              Margin="0,0,12,0"
              Content="{StaticResource Update}" />
            <TextBlock
              Text="{Binding [ButtonUpdate]}"
              VerticalAlignment="Center"
              FontSize="13" />
          </StackPanel>
        </Button>
      </StackPanel>
      <ToggleButton
        x:Name="buttonTop"
        Style="{StaticResource ToggleToolButton}"
        Width="46"
        Height="28"
        HorizontalAlignment="Right"
        VerticalAlignment="Top"
        Margin="0,0,92,0">
        <ToggleButton.Content>
          <Path
            Width="10"
            Height="10"
            Stretch="Uniform"
            StrokeThickness="1"
            Stroke="White"
            Data="M -4,-2 L 2,4 M -1,1 L -4,4 M -2,0 L 1,-3 L 3,-1 L 0,2 z" />
        </ToggleButton.Content>
        <ToggleButton.Tag>
          <Path
            Width="10"
            Height="10"
            Stretch="Uniform"
            StrokeThickness="1"
            Stroke="White"
            Fill="White"
            RenderTransformOrigin="0.5,0.5"
            Data="M -4,-2 L 2,4 M -1,1 L -4,4 M -2,0 L 1,-3 L 3,-1 L 0,2 z">
            <Path.RenderTransform>
              <RotateTransform
                Angle="-45" />
            </Path.RenderTransform>
          </Path>
        </ToggleButton.Tag>
      </ToggleButton>
      <Button
        x:Name="buttonMinimize"
        Content="{StaticResource Minimize}"
        Style="{StaticResource ToolButton}"
        Background="Transparent"
        Width="46"
        Height="28"
        HorizontalAlignment="Right"
        VerticalAlignment="Top"
        Margin="0,0,46,0" />
      <Button
        x:Name="buttonClose"
        Content="{StaticResource Close}"
        Style="{StaticResource ToolButton}"
        Background="Transparent"
        Width="46"
        Height="28"
        HorizontalAlignment="Right"
        VerticalAlignment="Top"
        Margin="0,0,0,0" />
      <TextBlock
        x:Name="textTitle"
        HorizontalAlignment="Left"
        VerticalAlignment="Top"
        Margin="12,6,0,0"
        Foreground="{DynamicResource TitleBarForeground}"
        Text="{Binding [Title]}" />
      <Popup
        AllowsTransparency="True"
        PopupAnimation="Fade"
        PlacementTarget="{Binding ElementName=buttonUpdate}"
        Placement="Center"
        VerticalOffset="-42"
        Grid.Row="3"
        IsOpen="{Binding ShowNewVersionPopup}">
        <Border
          BorderBrush="{DynamicResource TitleBarBackground}"
          BorderThickness="2"
          Background="{DynamicResource Background}">
          <TextBlock
            Margin="10"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            Text="{Binding [TextNewVersion]}"
            FontSize="16"
            Foreground="{Binding Foreground, ElementName=window}" />
        </Border>
      </Popup>
      <Popup
        AllowsTransparency="True"
        PopupAnimation="Fade"
        PlacementTarget="{Binding ElementName=buttonSave}"
        Placement="Center"
        VerticalOffset="-42"
        Grid.Row="3"
        IsOpen="{Binding ShowSavedPopup}">
        <Border
          BorderBrush="{DynamicResource TitleBarBackground}"
          BorderThickness="2"
          Background="{DynamicResource Background}">
          <TextBlock
            Margin="10"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            Text="{Binding [TextSaved]}"
            FontSize="16"
            Foreground="{Binding Foreground, ElementName=window}" />
        </Border>
      </Popup>
      <Popup
        AllowsTransparency="True"
        PopupAnimation="Fade"
        PlacementTarget="{Binding ElementName=window}"
        Placement="Center"
        Grid.RowSpan="3"
        IsOpen="False">
        <Border
          BorderBrush="{DynamicResource TitleBarBackground}"
          BorderThickness="2"
          Background="{DynamicResource Background}">
          <Grid>
            <Grid.RowDefinitions>
              <RowDefinition />
              <RowDefinition />
              <RowDefinition />
            </Grid.RowDefinitions>
            <TextBlock
              Grid.Row="0"
              Margin="10"
              HorizontalAlignment="Center"
              VerticalAlignment="Center"
              Text="{Binding [TextAvailablePatches]}"
              FontSize="24"
              Foreground="{DynamicResource Foreground}" />
            <TextBlock
              Grid.Row="1"
              FontSize="16"
              Margin="30,10"
              HorizontalAlignment="Left"
              VerticalAlignment="Center"
              Text="{Binding [Title]}" />

          </Grid>
        </Border>
      </Popup>
    </Grid>
  </Border>
</Window>
